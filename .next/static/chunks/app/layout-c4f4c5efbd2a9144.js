(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7524:function(t,e,r){Promise.resolve().then(r.t.bind(r,2998,23)),Promise.resolve().then(r.t.bind(r,2489,23)),Promise.resolve().then(r.bind(r,3286)),Promise.resolve().then(r.bind(r,4686))},4686:function(t,e,r){"use strict";r.r(e),r.d(e,{SubscriptionProvider:function(){return SubscriptionProvider},useSubscription:function(){return useSubscription}});var n=r(7437),i=r(2265),s=r(4829);let o=(0,i.createContext)(void 0),a="http://localhost:8000",SubscriptionProvider=t=>{let{children:e}=t,[r,c]=(0,i.useState)(null),[u,l]=(0,i.useState)([]),[d,h]=(0,i.useState)(null),[p,b]=(0,i.useState)(!1),[f,v]=(0,i.useState)(null),getAuthHeaders=()=>{let t=localStorage.getItem("token");return t?{Authorization:"Bearer ".concat(t)}:{}},fetchPlans=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{b(!0),v(null);let t=await s.Z.get("".concat(a,"/subscription/plans"));l(t.data.plans)}catch(n){var e,r;if(("ERR_NETWORK"===n.code||"ERR_CONNECTION_REFUSED"===n.code)&&t<3){console.log("Retrying fetchPlans (attempt ".concat(t+1,"/3)...")),setTimeout(()=>fetchPlans(t+1),2e3);return}v((null===(r=n.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.detail)||"Failed to fetch plans"),console.error("Error fetching plans:",n)}finally{b(!1)}},fetchCurrentSubscription=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{b(!0),v(null);let t=await s.Z.get("".concat(a,"/subscription/current"),{headers:getAuthHeaders()});c(t.data.subscription),h(t.data.features)}catch(i){var e,r,n;if(("ERR_NETWORK"===i.code||"ERR_CONNECTION_REFUSED"===i.code)&&t<3){console.log("Retrying fetchCurrentSubscription (attempt ".concat(t+1,"/3)...")),setTimeout(()=>fetchCurrentSubscription(t+1),2e3);return}(null===(e=i.response)||void 0===e?void 0:e.status)!==401&&v((null===(n=i.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.detail)||"Failed to fetch subscription"),console.error("Error fetching subscription:",i)}finally{b(!1)}},subscribeToPlan=async function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{b(!0),v(null);let r=await s.Z.post("".concat(a,"/subscription/subscribe"),{plan:t,trial:e},{headers:getAuthHeaders()});return c(r.data.subscription),h(r.data.features),!0}catch(t){var r,n;return v((null===(n=t.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.detail)||"Failed to subscribe"),console.error("Error subscribing:",t),!1}finally{b(!1)}},cancelSubscription=async()=>{try{return b(!0),v(null),await s.Z.post("".concat(a,"/subscription/cancel"),{},{headers:getAuthHeaders()}),await fetchCurrentSubscription(),!0}catch(r){var t,e;return v((null===(e=r.response)||void 0===e?void 0:null===(t=e.data)||void 0===t?void 0:t.detail)||"Failed to cancel subscription"),console.error("Error canceling subscription:",r),!1}finally{b(!1)}},checkFeatureAccess=async t=>{try{let e=await s.Z.get("".concat(a,"/subscription/check-access/").concat(t),{headers:getAuthHeaders()});return e.data.has_access}catch(t){return console.error("Error checking feature access:",t),!1}};return(0,i.useEffect)(()=>{{let t=window.location.pathname,e=t.startsWith("/auth/")||t.startsWith("/landing")||"/"===t;if(!e){fetchPlans();let t=localStorage.getItem("token");t&&fetchCurrentSubscription()}}},[]),(0,n.jsx)(o.Provider,{value:{subscription:r,plans:u,features:d,isLoading:p,error:f,fetchPlans,fetchCurrentSubscription,subscribeToPlan,cancelSubscription,checkFeatureAccess,hasFeatureAccess:t=>{if(!d)return!1;switch(t){case"advanced_analytics":return d.advanced_analytics;case"ai_insights":return d.ai_insights;case"social_trading":return d.social_trading;case"institutional_tools":return d.institutional_tools;case"priority_support":return d.priority_support;default:return!1}}},children:e})},useSubscription=()=>{let t=(0,i.useContext)(o);if(void 0===t)throw Error("useSubscription must be used within a SubscriptionProvider");return t};e.default=o},2489:function(){}},function(t){t.O(0,[216,592,744],function(){return t(t.s=7524)}),_N_E=t.O()}]);