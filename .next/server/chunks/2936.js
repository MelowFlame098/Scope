"use strict";exports.id=2936,exports.ids=[2936],exports.modules={2936:(e,t,s)=>{s.d(t,{Z:()=>components_RealTimeMarketData});var a=s(784),r=s(9885),i=s(2361),c=s(9795);let MarketDataService=class MarketDataService extends i.EventEmitter{constructor(){super(),this.priceCache=new Map,this.wsConnection=null,this.subscriptions=new Set,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.symbols=["AAPL","GOOGL","MSFT","AMZN","TSLA","META","NVDA","NFLX","BTC-USD","ETH-USD","ADA-USD","SOL-USD","DOT-USD","MATIC-USD","SPY","QQQ","IWM","GLD","SLV","VIX"],this.initializeWebSocket(),this.startPriceUpdates()}initializeWebSocket(){try{this.wsConnection=new WebSocket("wss://api.finscope.com/ws"),this.wsConnection.onopen=()=>{console.log("Market data WebSocket connected"),this.reconnectAttempts=0,this.emit("connected"),this.sendWebSocketMessage({type:"subscribe",symbols:Array.from(this.subscriptions)})},this.wsConnection.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleWebSocketMessage(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},this.wsConnection.onclose=e=>{console.log("WebSocket connection closed:",e.code,e.reason),this.emit("disconnected"),this.scheduleReconnect()},this.wsConnection.onerror=e=>{console.error("WebSocket error:",e),this.emit("error",e)}}catch(e){console.error("WebSocket connection failed:",e),this.scheduleReconnect()}}handleWebSocketMessage(e){switch(e.type){case"price_update":this.handlePriceUpdate(e.data);break;case"market_update":this.handleMarketUpdate(e.data);break;case"status":console.log("WebSocket status:",e.data);break;case"error":console.error("WebSocket error message:",e.data);break;default:console.log("Unknown message type:",e.type)}}handlePriceUpdate(e){let t={symbol:e.symbol,price:e.price,change:e.change,changePercent:e.change_percent,volume:e.volume||0,high24h:e.high_24h||1.05*e.price,low24h:e.low_24h||.95*e.price,marketCap:e.market_cap,timestamp:new Date(e.timestamp).getTime()};this.priceCache.set(e.symbol,t),this.emit("priceUpdate",{symbol:e.symbol,data:t})}handleMarketUpdate(e){e.prices&&Object.entries(e.prices).forEach(([e,t])=>{this.handlePriceUpdate({symbol:e,...t})})}sendWebSocketMessage(e){this.wsConnection&&this.wsConnection.readyState===WebSocket.OPEN&&this.wsConnection.send(JSON.stringify(e))}startPriceUpdates(){setInterval(()=>{this.symbols.forEach(e=>{let t=this.generateMockPriceData(e);this.updatePrice(e,t)})},2e3)}async updatePrice(e,t){this.priceCache.set(e,t),await c.$.cacheMarketData(e,t,60),await c.$.publish(`price:${e}`,t),this.emit("priceUpdate",{symbol:e,data:t})}generateMockPriceData(e){let t=this.getBasePrice(e),s=this.getVolatility(e),a=(Math.random()-.5)*s,r=t*(a/100),i=t+r,c=i*(1+.05*Math.random()),n=i*(1-.05*Math.random());return{symbol:e,price:Number(i.toFixed(2)),change:Number(r.toFixed(2)),changePercent:Number(a.toFixed(2)),volume:Math.floor(1e7*Math.random())+1e6,high24h:Number(c.toFixed(2)),low24h:Number(n.toFixed(2)),marketCap:this.calculateMarketCap(e,i),timestamp:Date.now()}}getBasePrice(e){return({AAPL:175.5,GOOGL:2850,MSFT:415.25,AMZN:3200,TSLA:245.8,META:485.6,NVDA:875.3,NFLX:425.9,"BTC-USD":43500,"ETH-USD":2650,"ADA-USD":.48,"SOL-USD":98.5,"DOT-USD":7.25,"MATIC-USD":.85,SPY:485.2,QQQ:395.8,IWM:198.5,GLD:185.3,SLV:22.45,VIX:15.8})[e]||100}getVolatility(e){return e.includes("BTC")||e.includes("ETH")?8:e.includes("USD")?12:"VIX"===e?15:"TSLA"===e?6:3}calculateMarketCap(e,t){let s={AAPL:15728e6,GOOGL:128e8,MSFT:743e7,AMZN:107e8,TSLA:317e7,META:265e7,NVDA:247e7,NFLX:442e6}[e];return s?Math.floor(s*t):void 0}async getCurrentPrice(e){let t=await c.$.getMarketData(e);if(t)return t;let s=this.priceCache.get(e);if(s)return s;let a=this.generateMockPriceData(e);return await this.updatePrice(e,a),a}async getMultiplePrices(e){let t={};return await Promise.all(e.map(async e=>{let s=await this.getCurrentPrice(e);s&&(t[e]=s)})),t}async getHistoricalData(e,t,s=100){let a=`historical:${e}:${t}:${s}`,r=await c.$.get(a);if(r)return r;let i=this.generateMockHistoricalData(e,t,s);return await c.$.set(a,i,300),i}generateMockHistoricalData(e,t,s){let a=this.getBasePrice(e),r=this.getVolatility(e),i=[],c=this.getTimeframeMs(t),n=Date.now(),l=a;for(let e=s-1;e>=0;e--){let t=n-e*c,s=l,a=(Math.random()-.5)*(r/10),o=s*(1+a/100),d=Math.max(s,o)*(1+.02*Math.random()),m=Math.min(s,o)*(1-.02*Math.random()),h=Math.floor(5e6*Math.random())+5e5;i.push({timestamp:t,open:Number(s.toFixed(2)),high:Number(d.toFixed(2)),low:Number(m.toFixed(2)),close:Number(o.toFixed(2)),volume:h}),l=o}return i}getTimeframeMs(e){return({"1m":6e4,"5m":3e5,"15m":9e5,"30m":18e5,"1h":36e5,"4h":144e5,"1d":864e5,"1w":6048e5,"1M":2592e6})[e]}async getMarketStats(){let e="market:stats",t=await c.$.get(e);if(t)return t;let s=await this.getMultiplePrices(this.symbols),a=Object.values(s),r=[...a].sort((e,t)=>t.changePercent-e.changePercent),i=[...a].sort((e,t)=>t.volume-e.volume),n={totalMarketCap:a.reduce((e,t)=>e+(t.marketCap||0),0),totalVolume24h:a.reduce((e,t)=>e+t.volume,0),btcDominance:42.5,activeSymbols:this.symbols.length,topGainers:r.slice(0,5),topLosers:r.slice(-5).reverse(),mostActive:i.slice(0,5)};return await c.$.set(e,n,60),n}async getTechnicalIndicators(e){let t=`indicators:${e}`,s=await c.$.get(t);if(s)return s;let a=[{name:"RSI",value:100*Math.random(),signal:Math.random()>.5?"buy":Math.random()>.5?"sell":"neutral",timestamp:Date.now()},{name:"MACD",value:(Math.random()-.5)*10,signal:Math.random()>.5?"buy":Math.random()>.5?"sell":"neutral",timestamp:Date.now()},{name:"SMA_20",value:this.getBasePrice(e)*(.95+.1*Math.random()),signal:"neutral",timestamp:Date.now()}];return await c.$.set(t,a,120),a}subscribeToSymbol(e){this.subscriptions.add(e),this.wsConnection&&this.wsConnection.readyState===WebSocket.OPEN&&this.sendWebSocketMessage({type:"subscribe",symbols:[e]}),c.$.subscribe(`price:${e}`,t=>{this.emit("priceUpdate",{symbol:e,data:t})})}async unsubscribeFromSymbol(e){this.subscriptions.delete(e),this.wsConnection&&this.wsConnection.readyState===WebSocket.OPEN&&this.sendWebSocketMessage({type:"unsubscribe",symbols:[e]})}async fetchRealTimePrice(e){try{let t=await this.getCurrentPrice(e);if(t&&Date.now()-t.timestamp<3e4)return t;let s=await fetch(`/api/v2/market-data/price/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(s.ok){let t=await s.json(),a={symbol:t.symbol,price:t.price,change:t.change,changePercent:t.change_percent,volume:t.volume,high24h:t.high_24h,low24h:t.low_24h,marketCap:t.market_cap,timestamp:Date.now()};return await this.updatePrice(e,a),a}}catch(t){console.error(`Error fetching real-time price for ${e}:`,t)}return null}async fetchMultipleRealTimePrices(e){try{let t=await fetch("/api/v2/market-data/prices",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({symbols:e})});if(t.ok){let e=await t.json(),s={};return Object.entries(e.prices||{}).forEach(([e,t])=>{s[e]={symbol:e,price:t.price,change:t.change,changePercent:t.change_percent,volume:t.volume,high24h:t.high_24h,low24h:t.low_24h,marketCap:t.market_cap,timestamp:Date.now()},this.updatePrice(e,s[e])}),s}}catch(e){console.error("Error fetching multiple real-time prices:",e)}return await this.getMultiplePrices(e)}getSubscriptions(){return Array.from(this.subscriptions)}scheduleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&setTimeout(()=>{this.reconnectAttempts++,this.initializeWebSocket()},this.reconnectDelay*Math.pow(2,this.reconnectAttempts))}disconnect(){this.wsConnection&&(this.wsConnection.close(),this.wsConnection=null),this.subscriptions.clear(),this.emit("disconnected")}isConnected(){return this.wsConnection?.readyState===WebSocket.OPEN}};let n=new MarketDataService;var l=s(7),o=s(1817),d=s(9815),m=s(6908),h=s(5256),x=s(6494);let Card=({children:e,className:t=""})=>a.jsx("div",{className:`bg-white rounded-lg shadow-md border border-gray-200 ${t}`,children:e}),CardHeader=({children:e})=>a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e}),CardTitle=({children:e,className:t=""})=>a.jsx("h3",{className:`text-lg font-semibold text-gray-900 ${t}`,children:e}),CardContent=({children:e})=>a.jsx("div",{className:"px-6 py-4",children:e}),Badge=({children:e,variant:t="default"})=>a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{default:"bg-gray-100 text-gray-800",success:"bg-green-100 text-green-800",destructive:"bg-red-100 text-red-800"}[t]}`,children:e}),Button=({children:e,onClick:t,variant:s="default",size:r="default",disabled:i=!1})=>a.jsx("button",{onClick:t,disabled:i,className:`inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ${{default:"bg-blue-600 hover:bg-blue-700 text-white",outline:"border border-gray-300 bg-white hover:bg-gray-50 text-gray-700",ghost:"hover:bg-gray-100 text-gray-700"}[s]} ${{default:"px-4 py-2 text-sm",sm:"px-3 py-1.5 text-xs",lg:"px-6 py-3 text-base"}[r]}`,children:e}),components_RealTimeMarketData=({symbols:e=["BTC-USD","ETH-USD","AAPL","GOOGL","TSLA"],autoRefresh:t=!0,refreshInterval:s=5e3})=>{let[i,c]=(0,r.useState)({}),[p,u]=(0,r.useState)(null),[g,b]=(0,r.useState)(!1),[j,y]=(0,r.useState)(!0),[f,N]=(0,r.useState)(null),[w,C]=(0,r.useState)(null);(0,r.useEffect)(()=>{let initializeService=async()=>{try{y(!0),n.on("connected",()=>{b(!0),N(null)}),n.on("disconnected",()=>{b(!1)}),n.on("error",e=>{N(e.message||"Connection error")}),n.on("priceUpdate",({symbol:e,data:t})=>{c(s=>({...s,[e]:t})),C(new Date)}),e.forEach(e=>{n.subscribeToSymbol(e)}),await fetchInitialData()}catch(e){N("Failed to initialize market data service"),console.error("Market data initialization error:",e)}finally{y(!1)}};return initializeService(),()=>{e.forEach(e=>{n.unsubscribeFromSymbol(e)}),n.removeAllListeners()}},[e]),(0,r.useEffect)(()=>{if(!t)return;let e=setInterval(async()=>{await fetchLatestPrices()},s);return()=>clearInterval(e)},[t,s,e]);let fetchInitialData=async()=>{try{let t=await n.fetchMultipleRealTimePrices(e);c(t);let s=await n.getMarketStats();u(s),C(new Date)}catch(e){console.error("Error fetching initial data:",e),N("Failed to fetch initial market data")}},fetchLatestPrices=async()=>{try{let t=await n.fetchMultipleRealTimePrices(e);c(e=>({...e,...t})),C(new Date)}catch(e){console.error("Error fetching latest prices:",e)}},v=(0,r.useCallback)(async()=>{y(!0),await fetchInitialData(),y(!1)},[e]),formatPrice=e=>e>=1e3?e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):e.toFixed(e<1?6:2),formatChange=(e,t)=>{let s=e>=0;return{text:`${s?"+":""}${e.toFixed(2)} (${s?"+":""}${t.toFixed(2)}%)`,color:s?"text-green-600":"text-red-600",icon:s?a.jsx(l.Z,{className:"w-4 h-4"}):a.jsx(o.Z,{className:"w-4 h-4"})}},formatVolume=e=>e>=1e9?`${(e/1e9).toFixed(1)}B`:e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString(),formatMarketCap=e=>e>=1e12?`$${(e/1e12).toFixed(2)}T`:e>=1e9?`$${(e/1e9).toFixed(2)}B`:e>=1e6?`$${(e/1e6).toFixed(2)}M`:`$${e.toLocaleString()}`;return j&&0===Object.keys(i).length?a.jsx("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center p-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),a.jsx("span",{className:"ml-2 text-gray-600",children:"Loading market data..."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Real-Time Market Data"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${g?"bg-green-500":"bg-red-500"}`}),a.jsx("span",{className:`text-sm ${g?"text-green-600":"text-red-600"}`,children:g?"Connected":"Disconnected"})]}),w&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Last update: ",w.toLocaleTimeString()]})]}),(0,a.jsxs)(Button,{onClick:v,disabled:j,variant:"outline",children:[a.jsx(d.Z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),f&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:a.jsx("div",{className:"flex",children:(0,a.jsxs)("div",{className:"text-red-800",children:[a.jsx("strong",{children:"Error:"})," ",f]})})}),p&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(Card,{children:a.jsx(CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(m.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Market Cap"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:formatMarketCap(p.totalMarketCap)})]})]})})}),a.jsx(Card,{children:a.jsx(CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(h.Z,{className:"h-8 w-8 text-green-600"}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"24h Volume"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:formatVolume(p.totalVolume24h)})]})]})})}),a.jsx(Card,{children:a.jsx(CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(d.Z,{className:"h-8 w-8 text-purple-600"}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Symbols"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.activeSymbols})]})]})})}),a.jsx(Card,{children:a.jsx(CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(x.Z,{className:"h-8 w-8 text-yellow-600"}),(0,a.jsxs)("div",{className:"ml-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"BTC Dominance"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[p.btcDominance.toFixed(1),"%"]})]})]})})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>{let t=i[e];if(!t)return(0,a.jsxs)(Card,{children:[a.jsx(CardHeader,{children:a.jsx(CardTitle,{children:e})}),a.jsx(CardContent,{children:(0,a.jsxs)("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),a.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})]},e);let s=formatChange(t.change,t.changePercent);return(0,a.jsxs)(Card,{className:"hover:shadow-lg transition-shadow",children:[a.jsx(CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx(CardTitle,{children:e}),a.jsx(Badge,{variant:t.change>=0?"success":"destructive",children:s.icon})]})}),a.jsx(CardContent,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-3xl font-bold text-gray-900",children:["$",formatPrice(t.price)]}),(0,a.jsxs)("p",{className:`text-sm font-medium flex items-center ${s.color}`,children:[s.icon,a.jsx("span",{className:"ml-1",children:s.text})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-gray-600",children:"24h High"}),(0,a.jsxs)("p",{className:"font-semibold",children:["$",formatPrice(t.high24h)]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-gray-600",children:"24h Low"}),(0,a.jsxs)("p",{className:"font-semibold",children:["$",formatPrice(t.low24h)]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-gray-600",children:"Volume"}),a.jsx("p",{className:"font-semibold",children:formatVolume(t.volume)})]}),t.marketCap&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-gray-600",children:"Market Cap"}),a.jsx("p",{className:"font-semibold",children:formatMarketCap(t.marketCap)})]})]}),a.jsx("div",{className:"pt-2 border-t border-gray-200",children:(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Updated: ",new Date(t.timestamp).toLocaleTimeString()]})})]})})]},e)})}),p&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(Card,{children:[a.jsx(CardHeader,{children:(0,a.jsxs)(CardTitle,{className:"flex items-center",children:[a.jsx(l.Z,{className:"w-5 h-5 text-green-600 mr-2"}),"Top Gainers"]})}),a.jsx(CardContent,{children:a.jsx("div",{className:"space-y-3",children:p.topGainers.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900 w-16",children:e.symbol}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["$",formatPrice(e.price)]})]}),(0,a.jsxs)(Badge,{variant:"success",children:["+",e.changePercent.toFixed(2),"%"]})]},e.symbol))})})]}),(0,a.jsxs)(Card,{children:[a.jsx(CardHeader,{children:(0,a.jsxs)(CardTitle,{className:"flex items-center",children:[a.jsx(o.Z,{className:"w-5 h-5 text-red-600 mr-2"}),"Top Losers"]})}),a.jsx(CardContent,{children:a.jsx("div",{className:"space-y-3",children:p.topLosers.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900 w-16",children:e.symbol}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["$",formatPrice(e.price)]})]}),(0,a.jsxs)(Badge,{variant:"destructive",children:[e.changePercent.toFixed(2),"%"]})]},e.symbol))})})]})]})]})}}};